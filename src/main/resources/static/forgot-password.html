<!DOCTYPE html>
<html>
<head>
    <title>Forgot Password</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
<div class="page">
    <h1>Reset Password</h1>

    <form id="forgotForm">
        <label>Email:
            <input type="email" id="email" required>
        </label>
        <label>Security question:
            <select id="securityQuestion" required>
                <option value="">Select the question you chose</option>
                <option value="Primary school name">Primary school name</option>
                <option value="Favourite animal">Favourite animal</option>
                <option value="Birth city">Birth city</option>
            </select>
        </label>
        <label>Security answer:
            <input type="text" id="securityAnswer" required>
        </label>
        <label>New password:
            <input type="password" id="password" required minlength="6">
        </label>
        <label>Confirm password:
            <input type="password" id="confirmPassword" required minlength="6">
        </label>
        <button type="submit">Change password</button>
    </form>

    <p id="message" class="message"></p>
    <p id="error" class="error"></p>

    <button type="button" onclick="window.location.href='/customer-login.html'">
        Back to login
    </button>

</div>

<script>
    document.getElementById('forgotForm').addEventListener('submit', async function (e) {
    e.preventDefault();
    const email = document.getElementById('email').value;
    const question = document.getElementById('securityQuestion').value; // currently not sent
    const answer = document.getElementById('securityAnswer').value;
    const pw = document.getElementById('password').value;
    const cpw = document.getElementById('confirmPassword').value;

    document.getElementById('message').textContent = '';
    document.getElementById('error').textContent = '';

    if (pw !== cpw) {
        document.getElementById('error').textContent = 'Passwords do not match.';
        return;
    }

    const res = await fetch('/api/auth/forgot-password-with-security', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            email,
            securityAnswer: answer,
            newPassword: pw
        })
    });

    const text = await res.text();
    if (res.ok) {
        document.getElementById('message').textContent =
            text || 'Password updated. You can now log in.';
    } else {
        document.getElementById('error').textContent =
            text || 'Email or security answer is incorrect.';
    }
});
</script>
</body>
</html>
